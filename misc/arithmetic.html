<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››åˆ™è¿ç®—é™æ—¶æŒ‘æˆ˜</title>
    <link rel="canonical" href="https://xplanc.org/primers/document/zh/03.HTML/90.å®è·µæ¡ˆä¾‹/AI.ç®—æœ¯ç»ƒä¹ .md"/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 30px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .description {
            color: #7f8c8d;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto 20px;
        }
        
        .config-panel {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }
        
        .config-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-item label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .config-item input, .config-item select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100px;
            text-align: center;
            font-size: 1rem;
        }
        
        .control-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }
        
        .timer-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .timer {
            font-size: 3.5rem;
            font-weight: 700;
            color: #e74c3c;
            padding: 10px 20px;
            border-radius: 10px;
            background-color: #fef5f5;
            display: inline-block;
            margin-bottom: 10px;
            min-width: 180px;
        }
        
        .timer-label {
            font-size: 1.2rem;
            color: #7f8c8d;
            font-weight: 600;
        }
        
        .questions-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .question-item {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 5px solid #3498db;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .question-number {
            font-weight: 700;
            color: #3498db;
            min-width: 30px;
        }
        
        .question-text {
            flex-grow: 1;
            font-size: 1.1rem;
        }
        
        .question-answer {
            width: 70px;
            padding: 8px 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .question-answer:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .question-answer.correct {
            border-color: #2ecc71;
            background-color: #eafaf1;
        }
        
        .question-answer.incorrect {
            border-color: #e74c3c;
            background-color: #fdedec;
        }
        
        .result-container {
            text-align: center;
            padding: 30px;
            background-color: #f8f9fa;
            border-radius: 10px;
            margin-top: 30px;
            display: none;
        }
        
        .result-title {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .result-score {
            font-size: 3rem;
            font-weight: 700;
            color: #2ecc71;
            margin-bottom: 20px;
        }
        
        .result-fail {
            color: #e74c3c;
        }
        
        .result-details {
            font-size: 1.2rem;
            color: #7f8c8d;
        }
        
        .result-error {
            color: #e74c3c;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .operator-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }
        
        .operator-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .operator-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .stats-panel {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f1f8ff;
            border-radius: 8px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0; /* ä¿è¯åœ¨ä¸€äº›æµè§ˆå™¨ä¸­ä¸ä¼šå‡ºç°é¢å¤–è¾¹è· */
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .questions-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .control-panel {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .timer {
                font-size: 2.8rem;
            }
            
            .stats-panel {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .questions-container {
                grid-template-columns: 1fr;
            }
            
            .config-panel {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .timer {
                font-size: 2.2rem;
                min-width: 150px;
            }
            
            .question-text {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å››åˆ™è¿ç®—é™æ—¶æŒ‘æˆ˜</h1>
            <p class="description">ç‚¹å‡»å¼€å§‹ç­”é¢˜åï¼Œç³»ç»Ÿå°†ç”Ÿæˆå››åˆ™è¿ç®—å¡«ç©ºé¢˜ã€‚</p>
            <p class="description">æ‚¨éœ€è¦åœ¨é™åˆ¶æ—¶é—´å†…å®Œæˆæ‰€æœ‰é¢˜ç›®ï¼Œå…¨éƒ¨ç­”å¯¹å³ä¸ºæŒ‘æˆ˜æˆåŠŸï¼</p>
            <p class="description">æ¥è‡ªï¼š<a class="description" target="_parent" href="https://xplanc.org/primers/document/zh/03.HTML/90.å®è·µæ¡ˆä¾‹/01.ç®—æœ¯ç»ƒä¹ .md">Primers ç¼–ç¨‹ä¼™ä¼´</a></p>
            <div class="operator-filter">
                <div class="operator-option">
                    <input type="checkbox" id="addCheck" checked>
                    <label for="addCheck">åŠ æ³• (+)</label>
                </div>
                <div class="operator-option">
                    <input type="checkbox" id="subCheck" checked>
                    <label for="subCheck">å‡æ³• (-)</label>
                </div>
                <div class="operator-option">
                    <input type="checkbox" id="mulCheck" checked>
                    <label for="mulCheck">ä¹˜æ³• (Ã—)</label>
                </div>
                <div class="operator-option">
                    <input type="checkbox" id="divCheck" checked>
                    <label for="divCheck">é™¤æ³• (Ã·)</label>
                </div>
            </div>
        </header>
        
        <div class="config-panel">
            <div class="config-item">
                <label for="timeLimit">ç­”é¢˜æ—¶é—´:</label>
                <input type="number" id="timeLimit" value="600" min="30" max="6000">
                <label >ç§’</label>
            </div>
            <div class="config-item">
                <label for="questionCount">é¢˜ç›®æ•°é‡:</label>
                <input type="number" id="questionCount" value="30" min="10" max="100">
            </div>
            <div class="config-item">
                <label for="numberRange">æ•°å­—èŒƒå›´:</label>
                <select id="numberRange">
                    <option value="1-9">1-9</option>
                    <option value="1-99" selected>1-99</option>
                    <option value="10-99">10-99</option>
                    <option value="100-999">100-999</option>
                </select>
            </div>
        </div>
        
        <div class="control-panel">
            <button id="startBtn" class="btn btn-primary">å¼€å§‹ç­”é¢˜</button>
            <button id="submitBtn" class="btn btn-secondary hidden">æäº¤ç­”æ¡ˆ</button>
        </div>
        
        <div class="timer-container">
            <div class="timer" id="timer">--:--</div>
            <div class="timer-label">å‰©ä½™æ—¶é—´</div>
        </div>
        
        <div class="stats-panel hidden" id="statsPanel">
            <div class="stat-item">
                <div class="stat-value" id="answeredCount">0</div>
                <div class="stat-label">å·²ç­”é¢˜</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="remainingCount">40</div>
                <div class="stat-label">å‰©ä½™é¢˜</div>
            </div>
        </div>
        
        <div id="questionsWrapper" class="hidden">
            <div class="questions-container" id="questionsContainer">
                <!-- é¢˜ç›®å°†åŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
            </div>
        </div>
        
        <div class="result-container" id="resultContainer">
            <h2 class="result-title">ç­”é¢˜ç»“æœ</h2>
            <div class="result-score" id="resultScore">40/40</div>
            <p class="result-details">æ‚¨æ€»å…±å›ç­”äº† <span id="totalQuestions">40</span> é“é¢˜ç›®</p>
            <p class="result-details">ç”¨æ—¶: <span id="timeUsed">00:00</span></p>
            <p class="result-error" id="errorCountInfo"></p>
            <p class="result-error" id="emptyCountInfo"></p>
            <p id="resultMessage"></p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let timer;
        let timeLeft;
        let questions = [];
        let userAnswers = {};
        let isTestActive = false;
        let startTime;
        
        // DOMå…ƒç´ 
        const startBtn = document.getElementById('startBtn');
        const submitBtn = document.getElementById('submitBtn');
        const timerDisplay = document.getElementById('timer');
        const questionsContainer = document.getElementById('questionsContainer');
        const questionsWrapper = document.getElementById('questionsWrapper');
        const resultContainer = document.getElementById('resultContainer');
        const resultScore = document.getElementById('resultScore');
        const totalQuestionsEl = document.getElementById('totalQuestions');
        const timeUsedEl = document.getElementById('timeUsed');
        const errorCountInfo = document.getElementById('errorCountInfo');
        const emptyCountInfo = document.getElementById('emptyCountInfo');
        const resultMessage = document.getElementById('resultMessage');
        const timeLimitInput = document.getElementById('timeLimit');
        const questionCountInput = document.getElementById('questionCount');
        const numberRangeSelect = document.getElementById('numberRange');
        const addCheck = document.getElementById('addCheck');
        const subCheck = document.getElementById('subCheck');
        const mulCheck = document.getElementById('mulCheck');
        const divCheck = document.getElementById('divCheck');
        const statsPanel = document.getElementById('statsPanel');
        const answeredCountEl = document.getElementById('answeredCount');
        const remainingCountEl = document.getElementById('remainingCount');
        
        // ç”Ÿæˆéšæœºæ•´æ•°ï¼ˆæ ¹æ®èŒƒå›´ï¼‰
        function getRandomNumber(min, max) {  
            const MIN = Math.floor(min);
            const MAX = Math.floor(max);          
            return Math.floor(Math.random() * (MAX - MIN + 1)) + MIN;
        }
        
        // è·å–é€‰ä¸­çš„è¿ç®—ç¬¦
        function getSelectedOperators() {
            const operators = [];
            if (addCheck.checked) operators.push('+');
            if (subCheck.checked) operators.push('-');
            if (mulCheck.checked) operators.push('Ã—');
            if (divCheck.checked) operators.push('Ã·');
            
            // è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¿ç®—ç¬¦
            if (operators.length === 0) {
                operators.push('+', '-', 'Ã—', 'Ã·');
                addCheck.checked = true;
                subCheck.checked = true;
                mulCheck.checked = true;
                divCheck.checked = true;
            }
            
            return operators;
        }
        
        // ç”Ÿæˆé¢˜ç›®
        function generateQuestions(count) {
            const newQuestions = [];
            const selectedOperators = getSelectedOperators();
            const numberRange = numberRangeSelect.value;
            const items = numberRange.split(/\D+/);
            const min = parseInt(items[0]);
            const max = parseInt(items[1]);
            
            // ä¸ºæ¯ç§è¿ç®—ç¬¦åˆ†é…å¤§è‡´ç›¸ç­‰çš„é¢˜ç›®æ•°é‡
            const operatorCounts = {};
            selectedOperators.forEach(op => {
                operatorCounts[op] = Math.floor(count / selectedOperators.length);
            });
            
            // å¤„ç†ä½™æ•°ï¼Œç¡®ä¿æ€»é¢˜ç›®æ•°æ­£ç¡®
            let remainder = count % selectedOperators.length;
            if (remainder > 0) {
                for (let i = 0; i < remainder; i++) {
                    const op = selectedOperators[i % selectedOperators.length];
                    operatorCounts[op]++;
                }
            }
            
            // ç”Ÿæˆæ¯ç§è¿ç®—ç¬¦çš„é¢˜ç›®
            selectedOperators.forEach(operator => {
                const opCount = operatorCounts[operator];
                
                for (let i = 0; i < opCount; i++) {
                    let num1, num2, answer;
                    let isValid = false;
                    let attempts = 0;
                    
                    // ç¡®ä¿ç”Ÿæˆæœ‰æ•ˆé¢˜ç›®ï¼ˆç»“æœä¸ºæ­£æ•´æ•°ä¸”ä¸æ˜¯ç®€å•é¢˜ç›®ï¼‰
                    while (!isValid && attempts < 100) {
                        attempts++;
                        
                        switch (operator) {
                            case '+':
                                num1 = getRandomNumber(min, max);
                                num2 = getRandomNumber(min, max);
                                answer = num1 + num2;
                                break;
                            case '-':
                                // ç¡®ä¿ç»“æœä¸ºæ­£æ•°ä¸”ä¸æ˜¯0
                                num1 = getRandomNumber(min, max);
                                num2 = getRandomNumber(min, max);
                                if (num1 < num2) {
                                    [num1, num2] = [num2, num1];
                                }
                                answer = num1 - num2;
                                break;
                            case 'Ã—':
                                // é™åˆ¶ä¹˜æ³•ç»“æœä¸è¶…è¿‡1000ä¸”é¿å…ç®€å•ä¹˜æ³•
                                num1 = getRandomNumber(2, max / 2);
                                num2 = getRandomNumber(2, max / num1);
                                
                                answer = num1 * num2;
                                break;
                            case 'Ã·':
                                // ç”Ÿæˆé™¤æ³•é¢˜ç›®ï¼Œç¡®ä¿èƒ½æ•´é™¤ä¸”é™¤æ•°ä¸æ˜¯1
                                // ç”Ÿæˆä¸€ä¸ªé™¤æ•°ï¼ˆç¡®ä¿ä¸æ˜¯1ï¼‰
                                num2 = getRandomNumber(2, max / 2);

                                // ç”Ÿæˆä¸€ä¸ªé™¤æ•°ï¼ˆç¡®ä¿ä¸æ˜¯1ï¼‰
                                answer = getRandomNumber(2, max / num2);
                                
                                // è®¡ç®—è¢«é™¤æ•°
                                num1 = answer * num2;

                                break;
                        }
                        
                        // ç¡®ä¿ç­”æ¡ˆä¸ºæ­£æ•´æ•°ä¸”ä¸è¶…è¿‡ä¸‰ä½æ•°
                        if (Number.isInteger(answer) && answer > 0 && answer <= 999) {
                            // å¯¹äºå‡æ³•ï¼Œç¡®ä¿ç»“æœä¸æ˜¯0
                            if (operator === '-' && answer === 0) {
                                continue;
                            }
                            
                            // å¯¹äºé™¤æ³•ï¼Œç¡®ä¿é™¤æ•°ä¸æ˜¯1ä¸”ç­”æ¡ˆå¤§äº1
                            if (operator === 'Ã·' && (num2 === 1 || answer === 1)) {
                                continue;
                            }

                            // ç¡®ä¿ä¸é‡å¤
                            if (newQuestions.some(q => q.num1 === num1 && q.num2 === num2 && q.operator === operator)) {
                                continue;
                            }

                            isValid = true;
                        }
                    }
                    
                    // æ— æ³•ç”Ÿæˆä¸é‡å¤çš„é¢˜ç›®
                    if (!isValid) {
                        isValid = true;
                        switch (operator) {
                            case '+':
                                num1 = getRandomNumber(min, max);
                                num2 = getRandomNumber(min, max);
                                answer = num1 + num2;
                            case '-':
                                // ç¡®ä¿ç»“æœä¸ºæ­£æ•°ä¸”ä¸æ˜¯0
                                num1 = getRandomNumber(min, max);
                                num2 = getRandomNumber(min, max);
                                if (num1 < num2) {
                                    [num1, num2] = [num2, num1];
                                }
                                answer = num1 - num2;
                            case 'Ã—':
                                // é™åˆ¶ä¹˜æ³•ç»“æœä¸è¶…è¿‡1000ä¸”é¿å…ç®€å•ä¹˜æ³•
                                num1 = getRandomNumber(2, max / 2);
                                num2 = getRandomNumber(2, max / num1);
                                
                                answer = num1 * num2;
                            case 'Ã·':
                                // ç”Ÿæˆé™¤æ³•é¢˜ç›®ï¼Œç¡®ä¿èƒ½æ•´é™¤ä¸”é™¤æ•°ä¸æ˜¯1
                                // ç”Ÿæˆä¸€ä¸ªé™¤æ•°ï¼ˆç¡®ä¿ä¸æ˜¯1ï¼‰
                                num2 = getRandomNumber(2, max / 2);

                                // ç”Ÿæˆä¸€ä¸ªé™¤æ•°ï¼ˆç¡®ä¿ä¸æ˜¯1ï¼‰
                                answer = getRandomNumber(2, max / num2);
                                
                                // è®¡ç®—è¢«é™¤æ•°
                                num1 = answer * num2;
                        }
                    }


                    if (isValid) {
                        newQuestions.push({
                            id: newQuestions.length + 1,
                            num1,
                            num2,
                            operator,
                            answer,
                            userAnswer: null,
                            isCorrect: false
                        });
                    }
                }
            });
            
            // æ‰“ä¹±é¢˜ç›®é¡ºåº
            return newQuestions //.sort(() => Math.random() - 0.5).map((q, i) => ({...q, id: i + 1}));
        }
        
        // æ¸²æŸ“é¢˜ç›®
        function renderQuestions(questions) {
            questionsContainer.innerHTML = '';
            
            questions.forEach(question => {
                const questionEl = document.createElement('div');
                questionEl.className = 'question-item';
                
                questionEl.innerHTML = `
                    <div class="question-number">${question.id}.</div>
                    <div class="question-text">${question.num1} ${question.operator} ${question.num2} = </div>
                    <input type="number" class="question-answer" id="answer-${question.id}" data-id="${question.id}" placeholder="?" min="0" max="999">
                `;
                
                questionsContainer.appendChild(questionEl);
            });
            
            // æ·»åŠ è¾“å…¥äº‹ä»¶ç›‘å¬å™¨
            document.querySelectorAll('.question-answer').forEach(input => {
                input.addEventListener('input', function() {
                    const id = parseInt(this.dataset.id);
                    const value = this.value.trim();
                    
                    if (value === '') {
                        delete userAnswers[id];
                        this.classList.remove('correct', 'incorrect');
                    } else {
                        const numValue = parseInt(value);
                        userAnswers[id] = numValue;
                    }
                    
                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    updateStats();
                });
                
                // å…è®¸ä½¿ç”¨é”®ç›˜æ–¹å‘é”®åœ¨è¾“å…¥æ¡†ä¹‹é—´å¯¼èˆª
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const nextInput = this.parentElement.nextElementSibling?.querySelector('.question-answer');
                        if (nextInput) {
                            nextInput.focus();
                        }
                    }
                    
                    // Ctrl+Enter æäº¤ç­”æ¡ˆ
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        if (isTestActive) {
                            finishTest();
                        }
                    }
                });
                
            });
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            let answered = 0;
            let correct = 0;
            
            questions.forEach(question => {
                if (userAnswers[question.id] !== undefined) {
                    answered++;
                    
                    if (userAnswers[question.id] === question.answer) {
                        correct++;
                    }
                }
            });
            
            const total = questions.length;
            const remaining = total - answered;
            
            answeredCountEl.textContent = answered;
            remainingCountEl.textContent = remaining;
        }
        
        // å¼€å§‹æµ‹è¯•
        function startTest() {
            const questionCount = parseInt(questionCountInput.value) || 40;
            timeLeft = parseInt(timeLimitInput.value) || 180;
            
            // ç”Ÿæˆé¢˜ç›®
            questions = generateQuestions(questionCount);
            userAnswers = {};
            
            // æ¸²æŸ“é¢˜ç›®
            renderQuestions(questions);
            
            // æ˜¾ç¤ºé¢˜ç›®åŒºåŸŸå’Œç»Ÿè®¡é¢æ¿ï¼Œéšè—ç»“æœåŒºåŸŸ
            questionsWrapper.classList.remove('hidden');
            statsPanel.classList.remove('hidden');
            resultContainer.style.display = 'none';
            
            // æ˜¾ç¤ºæäº¤æŒ‰é’®ï¼Œéšè—å¼€å§‹æŒ‰é’®
            startBtn.classList.add('hidden');
            submitBtn.classList.remove('hidden');
            
            // å¼€å§‹è®¡æ—¶
            startTime = Date.now();
            isTestActive = true;
            updateTimerDisplay();
            
            // åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    finishTest();
                }
            }, 1000);
        }
        
        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // æ—¶é—´å°‘äº30ç§’æ—¶æ”¹å˜é¢œè‰²
            if (timeLeft < 30) {
                timerDisplay.style.color = '#e74c3c';
                timerDisplay.style.backgroundColor = '#fef5f5';
            } else if (timeLeft < 60) {
                timerDisplay.style.color = '#f39c12';
                timerDisplay.style.backgroundColor = '#fef9e7';
            } else {
                timerDisplay.style.color = '#3498db';
                timerDisplay.style.backgroundColor = '#f5fafe';
            }
        }
        
        // å®Œæˆæµ‹è¯•
        function finishTest() {
            clearInterval(timer);
            isTestActive = false;
            
            // è®¡ç®—å¾—åˆ†
            let correctCount = 0;
            let errorCount = 0;
            let unansweredCount = 0;
            
            questions.forEach(question => {
                const userAnswer = userAnswers[question.id];
                question.userAnswer = userAnswer;
                
                if (userAnswer === undefined || userAnswer === null) {
                    unansweredCount++;
                } else if (userAnswer === question.answer) {
                    correctCount++;
                    question.isCorrect = true;
                } else {
                    errorCount++;
                    question.isCorrect = false;
                }
            });
            
            // è®¡ç®—ç”¨æ—¶
            const endTime = Date.now();
            const timeUsedMs = endTime - startTime;
            const timeUsedSeconds = Math.floor(timeUsedMs / 1000);
            const minutesUsed = Math.floor(timeUsedSeconds / 60);
            const secondsUsed = timeUsedSeconds % 60;
            
            // æ˜¾ç¤ºç»“æœ
            questionsWrapper.classList.add('hidden');
            statsPanel.classList.add('hidden');
            resultContainer.style.display = 'block';
            
            totalQuestionsEl.textContent = questions.length;
            timeUsedEl.textContent = `${minutesUsed.toString().padStart(2, '0')}:${secondsUsed.toString().padStart(2, '0')}`;
            resultScore.textContent = `${correctCount}/${questions.length}`;
            
            // æ˜¾ç¤ºé”™è¯¯æ•°é‡ä¿¡æ¯
            if (errorCount > 0) {
                errorCountInfo.textContent = `é”™äº† ${errorCount} é“é¢˜ `;
                resultScore.classList.add('result-fail');
                
                // æ ¹æ®æ­£ç¡®ç‡æ˜¾ç¤ºä¸åŒä¿¡æ¯
                const accuracy = (correctCount / questions.length) * 100;
                if (accuracy >= 90) {
                    resultMessage.textContent = "éå¸¸æ¥è¿‘å®Œç¾ï¼å†ä»”ç»†ä¸€ç‚¹å°±èƒ½å…¨éƒ¨ç­”å¯¹äº†ï¼";
                } else if (accuracy >= 70) {
                    resultMessage.textContent = "è¡¨ç°ä¸é”™ï¼ç»§ç»­åŠªåŠ›ï¼Œä¸‹æ¬¡ä¼šæ›´å¥½ï¼";
                } else {
                    resultMessage.textContent = "éœ€è¦å¤šåŠ ç»ƒä¹ å“¦ï¼Œç»§ç»­åŠ æ²¹ï¼";
                }
                resultMessage.style.color = "#e74c3c";
            }
            
            if (unansweredCount > 0) {
                emptyCountInfo.textContent = `æœ‰ ${unansweredCount} é“é¢˜æœªä½œç­” `;
                resultScore.classList.add('result-fail');
                resultMessage.textContent = "æœ‰äº›é¢˜ç›®è¿˜æ²¡å®Œæˆå“¦ã€‚";
                resultMessage.style.color = "#f39c12";
            }
            
            if (correctCount === questions.length) {
                errorCountInfo.textContent = "";
                resultScore.classList.remove('result-fail');
                resultMessage.textContent = "æ­å–œï¼å…¨éƒ¨ç­”å¯¹äº†ï¼ä½ æ˜¯æ•°å­¦å°å¤©æ‰ï¼ğŸ‰";
                resultMessage.style.color = "#2ecc71";
            }
            
            // æ˜¾ç¤ºå¼€å§‹æŒ‰é’®ï¼Œéšè—æäº¤æŒ‰é’®
            startBtn.classList.remove('hidden');
            submitBtn.classList.add('hidden');
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        startBtn.addEventListener('click', startTest);
        
        submitBtn.addEventListener('click', function() {
            if (isTestActive) {
                if (confirm('ç¡®å®šè¦æå‰æäº¤ç­”æ¡ˆå—ï¼Ÿ')) {
                    finishTest();
                }
            }
        });
        
        // åˆå§‹åŠ è½½æ—¶æ˜¾ç¤ºå¼€å§‹æŒ‰é’®
        window.addEventListener('DOMContentLoaded', () => {
            startBtn.classList.remove('hidden');
            submitBtn.classList.add('hidden');
            
            // ç”Ÿæˆç¤ºä¾‹é¢˜ç›®ï¼ˆç¡®ä¿æ²¡æœ‰é™¤ä»¥1çš„æƒ…å†µï¼‰
            let sampleQuestion;
            let attempts = 0;
            do {
                sampleQuestion = generateQuestions(1)[0];
                attempts++;
                // é˜²æ­¢æ— é™å¾ªç¯
                if (attempts > 10) break;
            } while (sampleQuestion.operator === 'Ã·' && (sampleQuestion.num2 === 1 || sampleQuestion.answer === 1));
            
            const sampleEl = document.createElement('p');
            sampleEl.className = 'description';
            sampleEl.style.marginTop = '10px';
            sampleEl.innerHTML = `ç¤ºä¾‹é¢˜ç›®: ${sampleQuestion.num1} ${sampleQuestion.operator} ${sampleQuestion.num2} = <span style="color:#3498db; font-weight:bold">${sampleQuestion.answer}</span>`;
            document.querySelector('header').appendChild(sampleEl);
        });
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            // ç©ºæ ¼é”®å¼€å§‹/é‡æ–°å¼€å§‹
            if (e.code === 'Space' && !isTestActive) {
                e.preventDefault();
                startTest();
            }
        });
        
        // è¾“å…¥æ¡†é™åˆ¶ï¼šåªå…è®¸è¾“å…¥æ•°å­—
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('question-answer')) {
                // ç§»é™¤éæ•°å­—å­—ç¬¦
                e.target.value = e.target.value.replace(/[^\d]/g, '');
                
                // é™åˆ¶æœ€å¤§å€¼
                if (e.target.value.length > 3) {
                    e.target.value = e.target.value.slice(0, 3);
                }
            }
        });
    </script>
</body>
</html>